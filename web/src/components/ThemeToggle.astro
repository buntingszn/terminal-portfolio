---
// Theme toggle - switches between light and dark themes
---

<button
  id="theme-toggle"
  type="button"
  aria-label="Toggle theme"
  title="Toggle theme (t)"
>
  <span class="theme-icon" aria-hidden="true"></span>
</button>

<style>
  button {
    background: var(--border);
    border: none;
    color: var(--muted);
    cursor: pointer;
    padding: 1px 4px;
    border-radius: 2px;
    font-family: 'JetBrains Mono', monospace;
    font-size: inherit;
    transition:
      color 0.2s ease,
      background-color 0.2s ease;
  }

  button:hover {
    color: var(--accent);
  }

  button:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
  }
</style>

<script>
  const toggle = document.getElementById('theme-toggle')
  const icon = toggle?.querySelector('.theme-icon')

  function getTheme(): string {
    const stored = localStorage.getItem('theme')
    if (stored) return stored
    return window.matchMedia('(prefers-color-scheme: light)').matches
      ? 'light'
      : 'dark'
  }

  function setTheme(theme: string) {
    document.documentElement.setAttribute('data-theme', theme)
    localStorage.setItem('theme', theme)
    updateIcon(theme)
  }

  function updateIcon(theme: string) {
    if (icon) {
      icon.textContent = theme === 'dark' ? 'light' : 'dark'
    }
  }

  // Initialize
  const currentTheme = getTheme()
  setTheme(currentTheme)

  toggle?.addEventListener('click', () => {
    if (sessionStorage.getItem('random-mode') === '1') {
      document.dispatchEvent(new CustomEvent('exit-random'))
      return
    }
    const current = document.documentElement.getAttribute('data-theme')
    setTheme(current === 'dark' ? 'light' : 'dark')
  })

  document.addEventListener('activate-random', () => {
    if (icon) icon.textContent = 'random'
  })

  document.addEventListener('exit-random', () => {
    const theme = localStorage.getItem('theme') ||
      (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark')
    updateIcon(theme)
  })
</script>
